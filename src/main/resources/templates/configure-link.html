<html>

<head title="Payable Links">
<script type="text/javascript">
        function preload() {
            preloadPaymentOptions();
            paymentOptionSelected();
        }

        function preloadPaymentOptions() {
            // GET avaialble payment options
            // optionId
            // optionText
            // currency
            // currencyName

            var select = document.getElementById("payment-options");
            var option = document.createElement("option");
            option.textContent = "Bitcoin Lightning Network";
            option.value = "LIGHTNING_BTC";
            select.appendChild(option);
        }

        function paymentOptionSelected() {
            var selector = document.getElementById('payment-options');
            var value = selector[selector.selectedIndex].value;

            var currencyId = "SATOSHI_BTC";
            document.getElementById('currency').value = currencyId;

            var currencyName = "SATS";
            document.getElementById('currency-name').textContent = currencyName;
        }

        function checkLightningNode() {
            var lightningHost = document.getElementById('lightning-host').value;
            var lightningRpcPort = document.getElementById('lightning-rpc-port').value;

            var lightningInvoiceMacaroon = "AgEDbG5kAkcDChAvaVB7ar+cjSvHGt3ZAIUYEgEwGhYKB2FkZHJlc3MSBHJlYWQSBXdyaXRlGhcKCGludm9pY2VzEgRyZWFkEgV3cml0ZQAABiDorXdgA63Up4BRL3fgMpZ4muUOZnpU/Rp1ot4n5FCO/w==";
            var lightningTlsCert = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNFVENDQWJpZ0F3SUJBZ0lRYTZSYUhXV1ducHpnaEdSWGRnYXdoVEFLQmdncWhrak9QUVFEQWpBMk1SOHcKSFFZRFZRUUtFeFpzYm1RZ1lYVjBiMmRsYm1WeVlYUmxaQ0JqWlhKME1STXdFUVlEVlFRREV3cHpZM2N0TW1VeApZbUUwTUI0WERURTVNRE14T1RFeE1EVXpOMW9YRFRJd01EVXhNekV4TURVek4xb3dOakVmTUIwR0ExVUVDaE1XCmJHNWtJR0YxZEc5blpXNWxjbUYwWldRZ1kyVnlkREVUTUJFR0ExVUVBeE1LYzJOM0xUSmxNV0poTkRCWk1CTUcKQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJJOTEydlZaRERwVEk4clpFZXZReStjOVd5cE9Jb2VRcUVVQgpvbkJTWjQ4WncvVmVpWmlwSzQwRGVpanVTY2d0ZnFpQzZtQWdjTUZTLzR1VDBzaUJGTnFqZ2Fjd2dhUXdEZ1lEClZSMFBBUUgvQkFRREFnS2tNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdnWUFHQTFVZEVRUjVNSGVDQ25OamR5MHkKWlRGaVlUU0NDV3h2WTJGc2FHOXpkSUlFZFc1cGVJSUtkVzVwZUhCaFkydGxkSWNFZndBQUFZY1FBQUFBQUFBQQpBQUFBQUFBQUFBQUFBWWNFQ2c3SmlZY0VyQkVBQVljUS9vQUFBQUFBQUFEY0doVC8vZ2NBQlljUS9vQUFBQUFBCkFBQUFRbFgvL28vS2VvY0VNdy9QSWpBS0JnZ3Foa2pPUFFRREFnTkhBREJFQWlBcFNhdGhOUHdGbUNJZ0hMMkEKK0ZIbEdrRGMwenZWeUVrSE1EUXgvTXJVT3dJZ1k1MXVsS3JwclBjcXFtK3FrMzRmM1BrN2xRZjZxSEMyem02RwpINjRla2RjPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==";

            var xhr = new XMLHttpRequest();
            var url = "/ln-check";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var json = JSON.parse(xhr.responseText);
                    alert('Got node response. Checked: ' + json['nodeOk']);
                }
            }

            var data = JSON.stringify({"pubkeyHost": lightningHost, "rpcport": lightningRpcPort, "invoiceMacaroon": lightningInvoiceMacaroon, "tlsCert": lightningTlsCert});
            xhr.send(data);

            // Set error text
        }

        function submit() {
            var xhr = new XMLHttpRequest();
            var url = "/link";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var json = JSON.parse(xhr.responseText);
                    console.log(json['payableUrl']);
                    window.location.replace("/ok?url=" + json['payableUrl']);
                }
            };

            var url = document.getElementById('url').value;
            var title = document.getElementById('title').value;
            var description = document.getElementById('description').value;
            var pseudonym = document.getElementById('pseudonym').value;

            var selector = document.getElementById('payment-options');
            var value = selector[selector.selectedIndex].value;
            var price = document.getElementById('price').value;
            var currency = document.getElementById('currency').value;

            var lightningHost = document.getElementById('lightning-host').value;
            var lightningRpcPort = document.getElementById('lightning-rpc-port').value;

            var lightningInvoiceMacaroon = '';
            var lightningTlsCert = '';

            var data = JSON.stringify({"url": url, "title": title, "price": price, "currency": "DUMMY_COIN", "paymentOptionType": "DUMMY_COIN", "paymentOptionArgs": {}});
            xhr.send(data);
        }

        function validationErrors() {
        }

</script>
</head>

<body onload="preload();">
    <p>Create a Payable Link</p>
    <table>
        <tr>
            <td>URL with content</td>
            <td colspan="2"><input id="url" type="text"/></td>
        </tr>
        <tr>
            <td>Content title</td>
            <td colspan="2"><input id="title" type="text"/></td>
        </tr>
        <tr>
            <td>Content description (optional)</td>
            <td colspan="2"><textarea id="description"></textarea></td>
        </tr>
        <tr>
            <td>Your name or pseudonym (optional)</td>
            <td colspan="2"><input id="pseudonym" type="text"/></td>
        </tr>
        <tr>
            <td>Payment method</td>
            <td colspan="2"><select id="payment-options"></select></td>
        </tr>
        <tr>
            <td>Amount requested per access</td>
            <td><input id="price" type="text"></td>
            <td><span id="currency-name"></span></td>
            <td><input id="currency" type="hidden" value="SATOSHI_BTC"></td>
        </tr>

        <!--DYNAMIC FIELDS FOR LIGHTNING OPTION-->
        <tr>
            <td>Lightning Node host / IP address</td>
            <td colspan="2"><input id="lightning-host" type="text"/></td>
        </tr>
        <tr>
            <td>Node RPC Port number</td>
            <td colspan="2"><input id="lightning-rpc-port" type="text"/></td>
        </tr>
        <tr>
            <td>Invoice Macaroon</td>
            <td colspan="2"><input id="lightning-invoice-macaroon" type="file"/></td>
        </tr>
        <tr>
            <td>TLS Certificate</td>
            <td colspan="2"><input id="lightning-tls-cert" type="file"/></td>
        </tr>
        <!--END DYNAMIC FIELDS -->

        <tr>
            <td colspan="3" onclick="checkLightningNode();"><button>Create</button></td>
        </tr>
    </table>
</body>

</html>